FROM python:3.10

WORKDIR /app

COPY requirements.txt .

RUN pip install --no-cache-dir -r requirements.txt

COPY . .

EXPOSE 8000

# Environment variables for core Django application
ARG SQLLITE
ARG CORS_ALLOWED_ORIGINS
ARG ALLOWED_HOSTS

ENV SQLLITE $SQLLITE
ENV CORS_ALLOWED_ORIGINS $CORS_ALLOWED_ORIGINS
ENV ALLOWED_HOSTS $ALLOWED_HOSTS

# Environment variables for external service secrets
ARG OPENAI_API_KEY
ARG CLAUDE_API_KEY
ARG MISTRAL_API_KEY
ARG HUGGINGFACE_API_KEY
ARG REVCAT_WEBHOOK_SECRET
ARG EMAIL_HOST
ARG EMAIL_HOST_PASSWORD
ARG GOOGLE_CLIENT_ID
ARG GOOGLE_CLIENT_SECRET

ENV OPENAI_API_KEY $OPENAI_API_KEY
ENV CLAUDE_API_KEY $CLAUDE_API_KEY
ENV MISTRAL_API_KEY $MISTRAL_API_KEY
ENV HUGGINGFACE_API_KEY $HUGGINGFACE_API_KEY
ENV REVCAT_WEBHOOK_SECRET $REVCAT_WEBHOOK_SECRET
ENV EMAIL_HOST $EMAIL_HOST
ENV EMAIL_HOST_PASSWORD $EMAIL_HOST_PASSWORD
ENV GOOGLE_CLIENT_ID $GOOGLE_CLIENT_ID
ENV GOOGLE_CLIENT_SECRET $GOOGLE_CLIENT_SECRET

CMD ["gunicorn", "-b", ":8000", "ai-backend-starter.wsgi:application"]
